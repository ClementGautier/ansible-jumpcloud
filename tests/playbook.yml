---
- hosts: localhost
  gather_facts: false
  tasks:
    - include_tasks: tasks/check_docker.yml

# - name: Bring up docker containers
#   hosts: all:!localhost
#   gather_facts: false
#   vars:
#     # ansible_ssh_private_key_file: '.vagrant/machines/{{ inventory_hostname}}/virtualbox/private_key'
#     # vagrant_ssh_key: "{{ ansible_ssh_private_key_file }}"
#
#     # - pause: seconds=3
#     # - include_tasks: tasks/load_vagrant_ssh_key.yml
#   roles:
#     - { role: provision_docker }

- name: Bring up docker containers
  hosts: localhost
  gather_facts: false
  # vars:
  #   inventory:
  #     - name: centos6
  #       image: "chrismeyers/centos6"
  #     - name: centos7
  #       image: "chrismeyers/centos7"
  #     - name: debian-stable
  #       image: "debian:stable"
  #     - name: ubuntu1204
  #       image: "chrismeyers/ubuntu12.04"
  #     - name: ubuntu1404
  #       image: "ubuntu:14.04"
  #     - name: ubuntu1604
  #       image: "ubuntu:16.04"
  #     - name: ubuntu1804
  #       image: "ubuntu:18.04"
  roles:
    # - { role: provision_docker, provision_docker_inventory: "{{ inventory }}" }
    - role: provision_docker
      provision_docker_inventory_group: "{{ groups['docker_containers']}}"



- hosts: docker_containers
  gather_facts: false
  become: true
  vars:
    jumpcloud_use_sudo: true

  tasks:
  - name: Install Python for Ansible requirements
    import_tasks: tasks/install_python.yml
  - import_tasks: tasks/install_yum_patch.yml

- hosts: docker_containers
  gather_facts: true
  become: true
  vars:
    enc_jumpcloud_x_connect_key: "{{ lookup('env','JUMPCLOUD_X_CONNECT_KEY') }}"
    jumpcloud_api_key: "{{ lookup('env','JUMPCLOUD_API_KEY') }}"
    jumpcloud_system_groups:
      - 'ansible_test_1'
      - 'ansible_test_2'
    jumpcloud_use_sudo: true
    jumpcloud_displayName: "ansible-jc-role-{{ ansible_hostname }}"

  pre_tasks:
    - name: Update the hostname
      command: hostname "{{ inventory_hostname }}test-with-ansible"

  roles:
      - { role: ansible-jumpcloud }

  tasks:
      - include_tasks: tasks/test_tasks.yml
